<!DOCTYPE html>
<html lang="zh-TW">
<head>

    <link rel="apple-touch-icon" href="icon.png">
    
    <link rel="icon" type="image/png" href="icon.png">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="å¥½ç¿’æ…£">
    <title>å¥½ç¿’æ…£</title>
<style>
    :root {
        --primary: #1a73e8; --success: #34a853; --warning: #fbc02d; --danger: #ea4335; --gray: #9aa0a6; --bg: #f0f2f5;
    }

    /* åŸºç¤è¨­å®šï¼šåŠ å¤§å­—é«”ï¼Œå¢åŠ åº•éƒ¨ç·©è¡é¿å…é®æ“‹ */
    body { 
        font-family: -apple-system, "Microsoft JhengHei", sans-serif; 
        margin: 0; background: var(--bg); padding-bottom: 120px; 
        color: #333; font-size: 30px; line-height: 1.5; 
    }

    /* æ³¨éŸ³å…¨å±€è¨­å®šï¼šå¼·åˆ¶ç½®é ‚ */
/* 1. æ³¨éŸ³èˆ‡åœ‹å­—çš„å®¹å™¨ */
ruby {
    display: inline-flex;
    flex-direction: column-reverse; /* è®“æ³¨éŸ³åœ¨åœ‹å­—ä¸Šæ–¹ */
    align-items: center;
    line-height: 1;           /* é‡é»ï¼šå°‡è¡Œé«˜è¨­ç‚º 1ï¼Œæ¶ˆé™¤å¤šé¤˜çš„ä¸Šä¸‹ç©ºæ ¼ */
    vertical-align: bottom;
}

/* 2. æ³¨éŸ³æœ¬é«” */
rt {
    font-size: 0.6em;
    color: var(--primary);
    line-height: 1;           /* é‡é»ï¼šæ¶ˆé™¤æ³¨éŸ³è‡ªèº«çš„é–“è· */
    display: block !important;
    text-align: center;
    padding: 0;               /* ç¢ºä¿æ²’æœ‰å…§è· */
    margin: 0 0 0px 0;       /* è² çš„ margin-bottom å¯ä»¥è®“æ³¨éŸ³æ›´è²¼è¿‘åœ‹å­— */
}


    /* é ‚éƒ¨æ¨™é¡Œ */
    .header { background: white; padding: 15px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
    .header h2 { margin: 0; color: var(--primary); font-size: 40px; }
    
    .page { display: none; padding: 15px; animation: fadeIn 0.2s; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* å¡ç‰‡èˆ‡æ¨™é¡Œ */
    .card { background: white; border-radius: 15px; padding: 18px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    h3 { margin: 0 0 15px 0; border-left: 5px solid var(--primary); padding-left: 10px; font-size: 26px; }

    /* å°è¦½åˆ—å®¹å™¨ï¼šä¿®æ­£é«˜åº¦ */
    .nav { 
        position: fixed; bottom: 0; width: 100%; 
        background: white; display: flex; 
        border-top: 1px solid #ddd; z-index: 1000; 
        min-height: 105px; padding-bottom: env(safe-area-inset-bottom);
    }

    /* å°è¦½é …ç›®ï¼šä¿®æ­£æ­ªæ–œï¼Œçµ±ä¸€å±…ä¸­ */
    .nav-item { 
        flex: 1; text-align: center; color: #777; cursor: pointer; font-weight: bold; font-size: 18px;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .nav-item.active { color: var(--primary); }

    /* åŠ å¤§åœ–ç¤º */
    .nav-item i { 
        display: block; font-size: 32px; margin-bottom: 8px; font-style: normal; line-height: 1;
    }

    /* é€²åº¦æ¢ */
    .progress-container { width: 100%; background: #eee; height: 16px; border-radius: 8px; margin: 12px 0; overflow: hidden; }
    .progress-bar { height: 100%; background: var(--primary); transition: width 0.3s ease; }
    .progress-bar.complete { background: var(--warning); animation: flashYellow 0.5s ease-in-out 3; }
    @keyframes flashYellow { 0%, 100% { background: var(--warning); } 50% { background: #fff176; } }

    /* è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ• */
    input { width: 100%; padding: 14px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 18px; }
    .main-btn { width: 100%; padding: 16px; border: none; border-radius: 12px; background: var(--primary); color: white; font-weight: bold; font-size: 20px; cursor: pointer; margin-bottom: 8px; }
    .item-row { padding: 15px 0; border-bottom: 1px solid #eee; }

/* è®“æŒ‰éˆ•èˆ‡çå‹µæ–‡å­—æ°´å¹³ä¸¦åˆ—çš„å®¹å™¨ */
.task-action-area {
    display: flex;
    align-items: center; /* å‚ç›´å±…ä¸­ */
      justify-content: space-between; /* é—œéµï¼šæ–‡å­—é å·¦ï¼ŒæŒ‰éˆ•é å³*/
    gap: 12px;           /* æŒ‰éˆ•èˆ‡æ–‡å­—çš„é–“è· */
    margin-top: 10px;
}

/* çå‹µç©åˆ†æ–‡å­—æ¨£å¼ */
.reward-info {
    font-size: 22px;       /* èˆ‡æŒ‰éˆ•å­—é«”å¤§å°ç›¸åŒ */
    font-weight: bold;
    color: var(--primary);
    line-height: 1;
    order:1;
}


/* ç¢ºä¿æŒ‰éˆ•å›ºå®šåœ¨å³å´ï¼Œå¯¬åº¦ç´„ 20-25% */
.task-action-area .main-btn {
    width: 25% !important; 
    margin: 0;
    padding: 10px 0;
    font-size: 18px;
    flex-shrink: 0;
    order: 2; /* å¼·åˆ¶æŒ‰éˆ•æ’åœ¨ç¬¬äºŒå€‹ */
}
/* å®¶é•·é–éš±å½¢å€å¡Šå®¹å™¨ */
.lock-overlay {
    display: flex;
    width: 100%;
    height: 60px; /* è§¸æ§å€åŸŸé«˜åº¦ */
    margin-bottom: 10px;
}

/* éš±å½¢æŒ‰éˆ•ï¼šå®Œå…¨é€æ˜ä½†å¯é»æ“Š */
.lock-btn {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
}

/* ç•¶è¨­å®šé è¢«é–å®šæ™‚ï¼Œè®“è£¡é¢çš„å¡ç‰‡çœ‹èµ·ä¾†è®Šæ·¡ */
.page-locked .card {
    opacity: 0.5;
    pointer-events: none; /* é–å®šæ™‚ç¦æ­¢é»æ“Šå¡ç‰‡å…§æ‰€æœ‰æ±è¥¿ */
}

/* è®“éš±å½¢å€å¡Šåœ¨é–å®šæ¨¡å¼ä¸‹ä¾ç„¶å¯ä»¥è¢«é»æ“Š */
.page-locked .lock-overlay {
    pointer-events: auto;
}
/* --- ä¿®å¾©å¾Œçš„è¨­å®šé  (Page 1) èˆ‡ä»»å‹™åˆ—æ’ç‰ˆ --- */

/* 1. åƒ…ç¸®å° Page 1 çš„å…§å®¹ï¼Œä¸å¹²æ“¾å…¶ä»–é é¢ */
#page1 .card * {
    font-size: 18px !important;
}
#page1 .card h3 {
    font-size: 22px !important;
}
#page1 input, #page1 button {
    padding: 10px !important;
    margin: 5px 0 !important;
    box-sizing: border-box;
}

/* 2. ç®¡ç†æ¸…å–®çš„å°å¡ç‰‡æ¨£å¼ */
.setting-item {
    background: white;
    padding: 12px;
    margin: 10px 0;
    border-radius: 10px;
    border-left: 6px solid var(--primary);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* 3. æ ¸å¿ƒæ’ç‰ˆä¿®å¾©ï¼šå¼·åˆ¶ Page 2 ä»»å‹™å·¦å³ä¸¦æ’ */
.item-row {
    background: white;
    margin-bottom: 10px;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.task-action-area {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: 12px;
    margin-top: 10px;
    width: 100%;
}

.reward-info {
    font-size: 22px !important;
    font-weight: bold;
    color: var(--primary);
    flex-grow: 1; /* è®“æ–‡å­—ä½”æ»¿å‰©é¤˜ç©ºé–“ */
}

/* ç¢ºä¿æŒ‰éˆ•åœ¨å³é‚Šä¸”å¤§å°é©ä¸­ */
.task-action-area .main-btn {
    width: 25% !important;
    min-width: 80px;
    margin: 0 !important;
    padding: 10px 5px !important;
    font-size: 18px !important;
}


    /* æ—¥æ›†éƒ¨åˆ† */
    .cal-title { text-align: center; font-size: 22px; font-weight: bold; margin-bottom: 15px; color: var(--primary); }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
    .cal-day { height: 50px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #fff; border-radius: 8px; border: 1px solid #eee; font-size: 16px; cursor: pointer; }
    .cal-has-data { background: #fff9c4; border-color: #fbc02d; }
    .cal-selected { background: var(--primary) !important; color: white !important; }
/* é•è¦æ—¥æœŸçš„ç´…æ¡†èˆ‡ç´…é»æ¨£å¼ */
.cal-punish-mark {
    border: 2px solid var(--danger) !important;
    position: relative; /* è®“ç´…é»å¯ä»¥ç›¸å°æ–¼æ ¼å­å®šä½ */
}

/* ç´…é»æ¨™è¨˜ */
.cal-punish-mark::after {
    content: ""; /* ç©ºå…§å®¹ï¼Œåªé¡¯ç¤ºåœ“é» */
    position: absolute;
    top: 5px;
    right: 5px;
    width: 10px;
    height: 10px;
    background-color: var(--danger);
    border-radius: 50%; /* è®Šæˆåœ“å½¢ */
    box-shadow: 0 0 4px rgba(234, 67, 53, 0.5); /* æ·¡æ·¡çš„ç´…å…‰ */
}

    .weekday-picker { display: flex; gap: 4px; margin: 10px 0; }
    .day-btn { flex: 1; padding: 12px 0; border: 1px solid #ddd; border-radius: 8px; background: white; font-size: 14px; text-align: center; cursor: pointer; }
    .day-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }
    
/* è­¦å‘ŠæŒ‰éˆ•ï¼šåˆå§‹è¨­å®šç‚ºéš±è— */
/* è­¦å‘ŠæŒ‰éˆ•ï¼šä¿®æ”¹ç‚ºåº•éƒ¨é•·å‹æ©«æ¢ */
/* è­¦å‘ŠæŒ‰éˆ•ï¼šé•·æ¢æ©«è·¨ç‰ˆ */
.warning-btn {
    display: none;             /* é è¨­éš±è— */
    position: fixed;
    bottom: 105px;             /* è·é›¢åº•éƒ¨é«˜åº¦ï¼Œé¿é–‹å°è¦½åˆ— */
    left: 0;                   /* å¾æœ€å·¦é‚Šé–‹å§‹ */
    width: 100%;               /* æ©«è·¨å·¦å³ */
    height: 50px;              /* æ‚¨è¦æ±‚çš„é«˜åº¦ 50px */
    background-color: #4A0000; /* åº•è‰²ï¼šæš—ç´…è‰² */
    color: white;              /* æ–‡å­—é¡è‰² */
    border: none;
    align-items: center;
    justify-content: center;
    font-size: 16px;           /* é©åˆ 30px çš„å­—é«”å¤§å° */
    font-weight: bold;
    z-index: 1500;
    
    /* æ ¸å¿ƒï¼šé˜² Android é¸å–®å¹²æ“¾ */
    touch-action: none !important;
    user-select: none;
    -webkit-user-select: none;
    cursor: pointer;
}

/* ä»»å‹™é  Active æ™‚é¡¯ç¤º */
.active .warning-btn {
    display: flex;
}

/* æŒ‰ä¸‹æ™‚çš„é–ƒçˆå‹•ç•« (æš—ç´…èˆ‡äº®ç´…åˆ‡æ›) */
@keyframes flash-warning {
    0% { background-color: #4A0000; }
    50% { background-color: #FF0000; }
    100% { background-color: #4A0000; }
}

/* é–ƒçˆç‹€æ…‹ Class */
.is-warning {
    animation: flash-warning 0.3s infinite; /* 0.3ç§’é–ƒçˆä¸€æ¬¡ */
}

/* è­¦å‘Šé é¢å°ˆå±¬çš„æ©˜è‰²é€²åº¦æ¢ */
.progress-bar.punish-style {
    background: #ff9800 !important; /* æ©˜è‰² */
}

.btn-edit {
    background: none;
    color: var(--primary);
    border: 1px solid var(--primary);
    padding: 4px 8px;
    border-radius: 5px;
    margin-right: 5px;
    cursor: pointer;
}
.btn-delete {
    background: none;
    color: var(--danger);
    border: 1px solid var(--danger);
    padding: 4px 8px;
    border-radius: 5px;
    cursor: pointer;
}

</style>

</head>
<body>

<div class="header">
    <div style="font-size: 14px; color: #666;">å¯ç”¨ç©åˆ†</div>
    <h2 id="displayPoints">0</h2>
</div>

<div id="page1" class="page active page-locked">
    <div class="lock-overlay">
        <button class="lock-btn" onclick="unlockStep('L')"></button>
        <button class="lock-btn" onclick="unlockStep('R')"></button>
    </div>
<div class="card">
    <h3>æ–°å¢ä»»å‹™</h3>
    <input type="text" id="taskName" placeholder="ä»»å‹™åç¨±">
    <input type="text" id="tZy" placeholder="æ³¨éŸ³ (ç”¨å…¨å½¢é€—è™Ÿéš”é–‹)">
    
    <div class="type-toggle" style="display: flex; background: #eee; border-radius: 10px; padding: 4px; margin: 10px 0;">
        <label id="labelReward" class="active" style="flex:1; text-align:center; padding:10px; border-radius:8px; cursor:pointer; font-size:18px; font-weight:bold; background:var(--primary); color:white;">
            <input type="radio" name="tType" value="reward" checked onchange="updateToggleStyle()" ,
style="position:absolute; opacity:0;"> çå‹µ
        </label>
        <label id="labelPunish" style="flex:1; text-align:center; padding:10px; border-radius:8px; cursor:pointer; font-size:18px; font-weight:bold; color:#333;">
            <input type="radio" name="tType" value="punish" onchange="updateToggleStyle()" 
style="position:absolute; opacity:0;"> æ‡²ç½°
        </label>
    </div>

    <input type="number" id="taskCount" placeholder="é”æˆ/é•è¦æ‰€éœ€æ¬¡æ•¸">
    <input type="number" id="taskPoints" placeholder="æ¯æ¬¡çå‹µ/æ‰£é™¤ç©åˆ†">

        <div class="weekday-picker">
            <div class="day-btn" data-day="0">æ—¥</div><div class="day-btn" data-day="1">ä¸€</div><div class="day-btn" data-day="2">äºŒ</div>
            <div class="day-btn" data-day="3">ä¸‰</div><div class="day-btn" data-day="4">å››</div><div class="day-btn" data-day="5">äº”</div>
            <div class="day-btn" data-day="6">å…­</div>
        </div>
    <button class="main-btn" onclick="addSettingTask()">ç¢ºèªæ–°å¢ä»»å‹™</button>
    <div class="card" style="margin-top:20px;">
    <h3>ä»»å‹™ç®¡ç†æ¸…å–®</h3>
    <div id="taskList"></div>
</div>

</div>
    <div class="card">
        <h3>æ–°å¢é“å…·</h3>
        <input type="text" id="iName" placeholder="é“å…·åç¨±">
        <input type="text" id="iZy" placeholder="æ³¨éŸ³ (ç”¨å…¨å½¢é€—è™Ÿéš”é–‹)">
        <input type="number" id="iCost" placeholder="æ‰€éœ€ç©åˆ†">
        <button class="main-btn" style="background:var(--success)" onclick="saveItem()">ç¢ºèªæ–°å¢é“å…·</button>
    </div>
        <div class="card">
        <h3>å•†åº—é“å…·ç®¡ç†</h3>
        <div id="manageItemList" style="margin-top: 10px;"></div>
    </div>

    <div class="card">
        <h3>æ•¸æ“šç®¡ç†</h3>
        <button class="main-btn" style="background:#607d8b" onclick="exportData()">ğŸ“¤ å‚™ä»½è³‡æ–™ (JSON)</button>
        <button class="main-btn" style="background:#9e9e9e" onclick="importData()">ğŸ“¥ é‚„åŸè³‡æ–™</button>
        <button onclick="clearAllData()" style="color:red; background:none; border:none; width:100%; margin-top:10px;margin-bottom:30px;padding:15px;font-size:12">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
    </div>
</div>

<div id="page2" class="page">
    <div class="card">
        <h3>ä»Šæ—¥ä»»å‹™</h3>
                <div id="dailyTotal" style="margin-top:10px; font-size:20px;font-weight:bold; color:var(--primary);">
            ä»Šæ—¥å¾—åˆ†ç¸½è¨ˆï¼š0 åˆ†
        </div>

        <div id="activeTasks"></div>
    </div>

    <div id="warningBtn" class="warning-btn">ğŸš¨ é•· æŒ‰ 3 ç§’ ç™¼ å‡º è­¦ å ± ğŸš¨</div>
</div>

<div id="page3" class="page">
    <div class="card">
        <h3>ç©åˆ†å•†åº—</h3>
        <div id="shopList"></div>
    </div>
</div>

<div id="page4" class="page">
    <div class="card">
        <h3>æˆ‘çš„èƒŒåŒ…</h3>
        <div id="myItemsList"></div>
    </div>
</div>

<div id="page5" class="page">
    <div class="card">
        <div id="calTitle" class="cal-title"></div>
        <div class="calendar-grid" id="calendarGrid"></div>
    </div>
    <div class="card">
        <h3 id="detailDateTitle">é»æ“Šæ—¥æœŸæŸ¥çœ‹è©³æƒ…</h3>
        <div id="dailyTotalRecord" style="margin-top:10px;font-size:20px; font-weight:bold; color:var(--primary);">
    ç•¶æ—¥å¾—åˆ†ç¸½è¨ˆï¼š0 åˆ†
</div>
        <div id="detailContent"></div>
    </div>
</div>
<div id="page6" class="page">
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="border-left-color: var(--danger); color: var(--danger);">ğŸš¨ æ‡²ç½°æ¸…å–®</h3>
            <button class="main-btn" onclick="showPage(2)" style="width:auto; padding:5px 15px; font-size:16px;">è¿”å›ä»»å‹™</button>
        </div>
        <div id="punishTaskList"></div>
    </div>
</div>

<div class="nav">
    <div class="nav-item active" onclick="showPage(1, this)">
        <i>âš™ï¸</i><ruby>è¨­å®š<rt>ã„•ã„œË‹ ã„‰ã„§ã„¥Ë‹</rt></ruby>
    </div>
    <div class="nav-item" onclick="showPage(2, this)">
        <i>âš¡</i><ruby>ä»»å‹™<rt>ã„–ã„£Ë‹ ã„¨Ë‹</rt></ruby>
    </div>
    <div class="nav-item" onclick="showPage(3, this)">
        <i>ğŸ›’</i><ruby>å•†åº—<rt>ã„•ã„¤ ã„‰ã„§ã„¢Ë‹</rt></ruby>
    </div>
    <div class="nav-item" onclick="showPage(4, this)">
        <i>ğŸ’</i><ruby>èƒŒåŒ…<rt>ã„…ã„Ÿ ã„…ã„ </rt></ruby>
    </div>
    <div class="nav-item" onclick="showPage(5, this)">
        <i>ğŸ“Š</i><ruby>è¨˜éŒ„<rt>ã„ã„§Ë‹ ã„Œã„¨Ë‹</rt></ruby>
    </div>
</div>

<script>
// --- 1. æ ¸å¿ƒç‹€æ…‹èˆ‡å…¨åŸŸè®Šæ•¸ ---
let state = { points: 0, tasks: [], items: [], inventory: {}, dailyLogs: {} };
let unlockSequence = [];
let isAdminMode = false;
let editingIndex = null;
let warningTimer, audioCtx, oscillator, gainNode;
// --- é“å…·ç®¡ç†æ ¸å¿ƒè®Šæ•¸ ---
let editingItemIndex = null; // ç´€éŒ„ç›®å‰æ­£åœ¨ç·¨è¼¯å“ªä¸€å€‹é“å…·
let enableParentLock = false; // æ§åˆ¶æ˜¯å¦å•Ÿç”¨å®¶é•·é–
let autoUnlockOnInit = true;   // æ§åˆ¶æ˜¯å¦åœ¨åˆå§‹åŒ–æ™‚è‡ªå‹•è§£é–
//å®¶é•·é–é–‹é—œæ–¹æ³• e:f+a:t é–‹å•Ÿç„¡é–
// åˆå§‹åŒ–ï¼šè¼‰å…¥è³‡æ–™ä¸¦å•Ÿå‹•åŠŸèƒ½
function init() {
    const saved = localStorage.getItem('taskMasterV7');
    if (saved) state = JSON.parse(saved);
        // å¦‚æœè¨­å®šè¦è‡ªå‹•è§£é–ï¼Œå°±åœ¨åˆå§‹åŒ–æ™‚è§£é–
    if (autoUnlockOnInit) {
        isAdminMode = true;
        const settingPage = document.getElementById('page1');
        if (settingPage) settingPage.classList.remove('page-locked');
    }

    document.getElementById('displayPoints').innerText = state.points;
    renderManageItems();
    setupWarningButton(); // å•Ÿå‹•è­¦å‘ŠæŒ‰éˆ•ç›£è½
    showPage(2); // é è¨­é¡¯ç¤ºä»»å‹™é 
}
// --- è£œä¸Šéºå¤±çš„æ—¥æœŸå‡½å¼ ---
function getTodayStr() {
    const now = new Date();
    // å›å‚³æ ¼å¼å¦‚ "2024-01-20"
    return now.getFullYear() + '-' + 
           String(now.getMonth() + 1).padStart(2, '0') + '-' + 
           String(now.getDate()).padStart(2, '0');
}
// å„²å­˜è³‡æ–™åˆ°æ‰‹æ©Ÿè¨˜æ†¶é«”
function save() {
    localStorage.setItem('taskMasterV7', JSON.stringify(state));
    document.getElementById('displayPoints').innerText = state.points;
}

      // --- 2. åˆ†é åˆ‡æ› ---
    
function showPage(num, el) {
    if(enableParentLock){
        isAdminMode = false;
    unlockSequence = [];
    const settingPage = document.getElementById('page1');
    if (settingPage) settingPage.classList.add('page-locked');//åˆ‡æ›åˆ†é æ™‚é–å®šé é¢
    }
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const targetPage = document.getElementById('page' + num);
    if (targetPage) targetPage.classList.add('active');
    
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    if (el) el.classList.add('active');

    // æ ¹æ“šé é¢ç·¨è™ŸåŸ·è¡Œæ¸²æŸ“
    if (num === 1) renderTasks();
    if (num === 2) renderActiveTasks(); 
    if (num === 3) renderShop();
    if (num === 4) renderInventory();
    if (num === 5) renderCalendar();
    if (num === 6) renderPunishTasks();
    window.scrollTo(0, 0);
}

// å®¶é•·è§£é–é‚è¼¯ (å·¦Rã€å³L åºåˆ—)
function unlockStep(side) {
    unlockSequence.push(side);
    const lastTwo = unlockSequence.slice(-2).join('');
    if (lastTwo === 'LR') {
        isAdminMode = true;
        const settingPage = document.getElementById('page1');
        if (settingPage) settingPage.classList.remove('page-locked');
        triggerVibrate();
        alert("ğŸ”“ å®¶é•·æ¨¡å¼å·²é–‹å•Ÿ");
        renderManageItems(); 
        unlockSequence = [];
    }
}
function addSettingTask() {
    try {
        const name = document.getElementById('taskName').value.trim();
        const count = parseInt(document.getElementById('taskCount').value);
        const points = parseInt(document.getElementById('taskPoints').value);
        const zy = document.getElementById('tZy').value.trim();
        
        // ä»»å‹™å½¢å¼
     const typeEl = document.querySelector('input[name="tType"]:checked');
        const isPunish = typeEl ? (typeEl.value === 'punish') : false;

        if (name && !isNaN(count) && !isNaN(points)) {
            state.tasks.push({ 
                id: Date.now(),
                name: name, 
                zy: zy, 
                isPunish: isPunish,
                total: count, 
                points: points, 
                current: 0 
            });
            
            save(); // å‘¼å«å„²å­˜
            
            // æ¸…ç©ºæ¬„ä½
            document.getElementById('taskName').value = '';
            document.getElementById('taskCount').value = '';
            document.getElementById('taskPoints').value = '';
            document.getElementById('tZy').value = '';
            
            renderTasks(); 
            alert('âœ… æ–°å¢æˆåŠŸä¸¦å·²å­˜æª”ï¼');
        } else {
            alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š (åç¨±ã€æ¬¡æ•¸ã€ç©åˆ†)');
        }
    } catch (err) {
        // å¦‚æœä¸Šé¢ä»»ä½•ä¸€è¡Œå£æ‰ï¼Œæ‰‹æ©Ÿæœƒè·³å‡ºé€™å€‹è¨Šæ¯
        alert("ç¨‹å¼åŸ·è¡Œå‡ºéŒ¯: " + err.message);
    }
}

function updateToggleStyle() {
    const isPunish = document.querySelector('input[name="tType"][value="punish"]').checked;
    
    const labelReward = document.getElementById('labelReward');
    const labelPunish = document.getElementById('labelPunish');

    if (isPunish) {
        // åˆ‡æ›åˆ°æ‡²ç½°æ¨£å¼
        labelPunish.style.background = 'var(--danger)'; // æ‡²ç½°ç”¨ç´…è‰²
        labelPunish.style.color = 'white';
        labelReward.style.background = 'transparent';
        labelReward.style.color = '#333';
    } else {
        // åˆ‡æ›åˆ°çå‹µæ¨£å¼
        labelReward.style.background = 'var(--primary)'; // çå‹µç”¨è—è‰²
        labelReward.style.color = 'white';
        labelPunish.style.background = 'transparent';
        labelPunish.style.color = '#333';
    }
}

function renderTasks() {
    const list = document.getElementById('taskList');
    if (!list) return;
    list.innerHTML = '';

    state.tasks.forEach((task, index) => {
        const div = document.createElement('div');
        div.className = 'setting-item';

        if (editingIndex === index) {
            // ç·¨è¼¯æ¨¡å¼ï¼šå››å€‹æ¬„ä½ä¸¦æ’é¡¯ç¤º
            div.innerHTML = `
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
                    <span style="min-width:80px;">ä»»å‹™åç¨±</span>
                    <input type="text" id="edit-name-${index}" class="edit-input" value="${task.name}">
                </div>
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
                    <span style="min-width:80px;">æ³¨éŸ³</span>
                    <input type="text" id="edit-zy-${index}" class="edit-input" value="${task.zy || ''}" placeholder="æ³¨éŸ³ (ç”¨å…¨å½¢é€—è™Ÿéš”é–‹)">
                </div>
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
                    <span style="min-width:80px;">å®Œæˆæ¬¡æ•¸</span>
                    <input type="number" id="edit-count-${index}" class="edit-input" value="${task.total}">
                </div>
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
                    <span style="min-width:80px;">ç²å¾—ç©åˆ†</span>
                    <input type="number" id="edit-points-${index}" class="edit-input" value="${task.points}">
                </div>
                <div style="margin-top:10px;">
                    <button onclick="saveEdit(${index})" 
                        style="background:var(--success); color:white; border:none; padding:8px 15px; border-radius:5px;">
                        å„²å­˜
                    </button>
                    <button onclick="cancelEdit()" 
                        style="background:var(--gray); color:white; border:none; padding:8px 15px; border-radius:5px;">
                        å–æ¶ˆ
                    </button>
                </div>
            `;
        } else {
            // é¡¯ç¤ºæ¨¡å¼
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <strong>${formatRuby(task.name, task.zy)}</strong><br>
                        <small>
                            ${task.isPunish ? 'ğŸš¨ æ‡²ç½°' : 'âœ… çå‹µ'} 
                            | åˆ†æ•¸:${task.points} 
                            | ç›®æ¨™:${task.total}æ¬¡
                        </small>
                    </div>
                    <div>
                        <button class="btn-edit" onclick="startEdit(${index})">ç·¨è¼¯</button>
                        <button class="btn-delete" onclick="deleteTask(${index})">åˆªé™¤</button>
                    </div>
                </div>
            `;
        }

        list.appendChild(div);
    });
}
function startEdit(i) { editingIndex = i; renderTasks(); }
function cancelEdit() { editingIndex = null; renderTasks(); }
function saveEdit(i) {
    state.tasks[i].name = document.getElementById(`edit-name-${i}`).value;
        state.tasks[i].zy = document.getElementById(`edit-zy-${i}`).value; // æ–°å¢æ³¨éŸ³æ¬„ä½

    state.tasks[i].total = parseInt(document.getElementById(`edit-count-${i}`).value);
    state.tasks[i].points = parseInt(document.getElementById(`edit-points-${i}`).value);
    editingIndex = null;
    save(); renderTasks();
}
function deleteTask(i) { if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")){ state.tasks.splice(i,1); save(); renderTasks(); } }

// --- 4. ä»»å‹™åŸ·è¡Œèˆ‡æ¸²æŸ“ ---
function renderActiveTasks() {
    const container = document.getElementById('activeTasks');
    if (!container) return;
    container.innerHTML = '';
    
    const dStr = getTodayStr();
    if (!state.dailyLogs[dStr]) state.dailyLogs[dStr] = { done: {}, buy: {}, use: {} };

    // 1. å–å¾—çå‹µä»»å‹™æ¸…å–®
    const rewardTasks = state.tasks.filter(t => !t.isPunish);
    
    // é™¤éŒ¯ï¼šå¦‚æœå®Œå…¨æ²’ä»»å‹™ï¼Œé¡¯ç¤ºæç¤º
    if (rewardTasks.length === 0) {
        container.innerHTML = '<div style="text-align:center; padding:40px; color:#999;">ç›®å‰æ²’æœ‰çå‹µä»»å‹™ï¼Œè«‹è‡³è¨­å®šé æ–°å¢ã€‚</div>';
        return;
    }

    rewardTasks.forEach(t => {
        // ä½¿ç”¨ t.id ä½œç‚ºæŸ¥è©¢é—œéµå­—
        const count = state.dailyLogs[dStr].done[t.id] || 0;
        const progress = Math.min((count / t.total) * 100, 100);
        const isFull = count >= t.total;
        
        const taskDiv = document.createElement('div');
        taskDiv.className = 'item-row';
        taskDiv.innerHTML = `
            <div>
                <strong>${formatRuby(t.name, t.zy)}</strong>
                <span style="font-size:18px; color:#666;"> (${count}/${t.total})</span>
            </div>
            
            <div class="progress-container" style="width: 100%; background: #eee; height: 12px; border-radius: 6px; margin: 10px 0; overflow: hidden;">
                <div class="progress-bar" style="width: ${progress}%; background: ${isFull ? '#fbc02d' : '#1a73e8'}; height: 100%; transition: width 0.3s;"></div>
            </div>

            <div class="task-action-area" style="display: flex; justify-content: space-between; align-items: center;">
                <div class="reward-info" style="font-size:18px; color:var(--success);">ğŸ çå‹µ: ${t.points} ç©åˆ†</div>
                <button class="main-btn" 
                    style="width:auto !important; min-width:80px; margin:0; padding:5px 20px; font-size:18px;"
                    onclick="doAction(${t.id})" 
                    ${isFull ? 'disabled' : ''}>
                    ${isFull ? 'å·²å®Œæˆ' : '+1'}
                </button>
            </div>
        `;
        container.appendChild(taskDiv);
    });
    renderDailyTotal();

}


function renderPunishTasks() {
    const list = document.getElementById('punishTaskList');
    if(!list) return;
    const dStr = getTodayStr();
    list.innerHTML = '';
    state.tasks.filter(t => t.isPunish).forEach(t => {
        const count = state.dailyLogs[dStr].done[t.id] || 0;
        list.innerHTML += `<div class="item-row">
            <strong style="color:var(--danger)">${formatRuby(t.name, t.zy)}</strong> (${count}/${t.total})
            <button class="main-btn" style="background:var(--danger)" onclick="doAction(${t.id})">+1 é•è¦</button>
        </div>`;
    });
}

function doAction(id) {
    const dStr = getTodayStr();
    const task = state.tasks.find(t => t.id === id);
    if (!state.dailyLogs[dStr]) state.dailyLogs[dStr] = { done: {}, buy: {}, use: {} };
    state.dailyLogs[dStr].done[id] = (state.dailyLogs[dStr].done[id] || 0) + 1;
    const currentCount = state.dailyLogs[dStr].done[id];
    if (currentCount <= task.total) {
        if (task.isPunish) {
            state.points = Math.max(0, state.points - task.points);
            triggerVibrate(); alert("ğŸš¨ é•è¦é”æ¨™ï¼Œå·²æ‰£åˆ†ï¼");
        } else {
            state.points += task.points;
            playDing(); triggerVibrate(); alert("ğŸ‰ ä»»å‹™å®Œæˆï¼");
        }
    
    }else {
        alert("âš ï¸ å·²é”ä¸Šé™ï¼Œç„¡æ³•å†è¨ˆåˆ†ï¼");
    }

    save();
    renderActiveTasks();
    renderPunishTasks();
    renderDailyTotal(); // æ›´æ–°æ¯æ—¥ç¸½åˆ†

}

function renderDailyTotal(dateStr = getTodayStr(), elementId = "dailyTotal") {
    let total = 0;
    if (state.dailyLogs[dateStr] && state.dailyLogs[dateStr].done) {
        for (const [taskId, count] of Object.entries(state.dailyLogs[dateStr].done)) {
            const task = state.tasks.find(t => t.id == taskId);
            if (task) {
                const validCount = Math.min(count, task.total);
                if (task.isPunish) {
                    total -= validCount * task.points; // æ‡²ç½°æ‰£åˆ†
                } else {
                    total += validCount * task.points; // çå‹µåŠ åˆ†
                }
            }
        }
    }
    document.getElementById(elementId).innerText = `ç•¶æ—¥å¾—åˆ†ç¸½è¨ˆï¼š${total} åˆ†`;
}
// --- 5. å•†åº—ã€èƒŒåŒ…èˆ‡æ—¥æ›† ---
function saveItem() {
    const name = document.getElementById('iName').value.trim();
    const cost = parseInt(document.getElementById('iCost').value);
    const zy = document.getElementById('iZy').value.trim();
    if (name && !isNaN(cost)) {
        state.items.push({ name, cost, zy });
        save(); alert("âœ… é“å…·æ–°å¢æˆåŠŸ");
        renderManageItems();
    }
}


// 1. æ¸²æŸ“é“å…·ç®¡ç†æ¸…å–® (è¨­å®šé  Page 1)
function renderManageItems() {
    const list = document.getElementById('manageItemList');
    if (!list) return;
    list.innerHTML = '';

    state.items.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'setting-item'; // ä½¿ç”¨èˆ‡ä»»å‹™ç›¸åŒçš„æ¨£å¼

        if (editingItemIndex === index) {
            // ç·¨è¼¯æ¨¡å¼
            div.innerHTML = `
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
                    <span style="min-width:80px;">é“å…·</span>
                    <input type="text" id="edit-item-name-${index}" class="edit-input" value="${item.name}">
                </div>
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
                    <span style="min-width:80px;">æ³¨éŸ³</span>
                    <input type="text" id="edit-item-zy-${index}" class="edit-input" value="${item.zy}">
                </div>
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px;">
                    <span style="min-width:80px;">æ³¨éŸ³</span>
                    <input type="number" id="edit-item-cost-${index}" class="edit-input" value="${item.cost}">
                </div>
            
                <div style="margin-top:10px;">
                    <button onclick="saveEditItem(${index})" 
                        style="background:var(--success); color:white; border:none; padding:8px 15px; border-radius:5px;">
                        å„²å­˜
                    </button>
                    <button onclick="cancelEditItem()" 
                        style="background:var(--gray); color:white; border:none; padding:8px 15px; border-radius:5px;">
                        å–æ¶ˆ
                    </button>
                </div>
            `;
        } else {
            // é¡¯ç¤ºæ¨¡å¼
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <strong>${formatRuby(item.name, item.zy)}</strong><br>
                        <span style="font-size:14px; color:#666;">åƒ¹æ ¼: ${item.cost} ç©åˆ†</span>
                    </div>
                    <div>
                        <button class="btn-edit" onclick="startEditItem(${index})">ç·¨è¼¯</button>
                        <button class="btn-delete" onclick="deleteItem(${index})">åˆªé™¤</button>
                    </div>
                </div>
            `;
        }
        list.appendChild(div);
    });
}

// 2. å•Ÿå‹•é“å…·ç·¨è¼¯
function startEditItem(index) {
    editingItemIndex = index;
    renderManageItems();
}

// 3. å–æ¶ˆé“å…·ç·¨è¼¯
function cancelEditItem() {
    editingItemIndex = null;
    renderManageItems();
}

// 4. å„²å­˜é“å…·ç·¨è¼¯
function saveEditItem(index) {
    const newName = document.getElementById(`edit-item-name-${index}`).value.trim();
    const newZy = document.getElementById(`edit-item-zy-${index}`).value.trim();
    const newCost = parseInt(document.getElementById(`edit-item-cost-${index}`).value);

    if (newName && !isNaN(newCost)) {
        // æ›´æ–°è³‡æ–™
        state.items[index].name = newName;
        state.items[index].zy = newZy;
        state.items[index].cost = newCost;
        
        editingItemIndex = null;
        save();
        renderManageItems(); // åˆ·æ–°ç®¡ç†åˆ—è¡¨
        renderShop();        // åˆ·æ–°å•†åº—é 
    } else {
        alert("è«‹å¡«å¯«æ­£ç¢ºçš„åç¨±èˆ‡åˆ†æ•¸ï¼");
    }
}

// 5. åˆªé™¤é“å…·
function deleteItem(index) {
    const itemName = state.items[index].name;
    if (confirm(`ç¢ºå®šè¦åˆªé™¤é“å…·ã€Œ${itemName}ã€å—ï¼Ÿ\n(é€™ä¸æœƒå½±éŸ¿å·²è³¼è²·çš„èƒŒåŒ…å…§å®¹)`)) {
        state.items.splice(index, 1);
        save();
        renderManageItems();
        renderShop();
    }
}

function renderShop() {
    const list = document.getElementById('shopList');
    list.innerHTML = '';
    state.items.forEach(i => {
        const canBuy = state.points >= i.cost;
        list.innerHTML += `<div class="item-row">
            <strong>${formatRuby(i.name, i.zy)}</strong> (${i.cost} ç©åˆ†)
            <button class="main-btn" style="width:auto;background:${canBuy?'var(--warning)':'#ccc'}" onclick="buyItem('${i.name}', ${i.cost})" ${canBuy?'':'disabled'}>å…Œæ›</button>
        </div>`;
    });
}

function buyItem(name, cost) {
    state.points -= cost;
    state.inventory[name] = (state.inventory[name] || 0) + 1;
    save(); renderShop(); alert("å…Œæ›æˆåŠŸ");
}

function renderInventory() {
    const list = document.getElementById('myItemsList');
    list.innerHTML = '';
    for (let name in state.inventory) {
        if (state.inventory[name] > 0) {
            const item = state.items.find(i => i.name === name) || {zy:""};
            list.innerHTML += `<div class="item-row">
                <strong>${formatRuby(name, item.zy)}</strong> (x${state.inventory[name]})
                <button class="main-btn" style="width:auto;background:var(--success)" onclick="useItem('${name}')">ä½¿ç”¨</button>
            </div>`;
        }
    }
}

function useItem(name) {
    state.inventory[name]--;
    save(); renderInventory(); alert("ä½¿ç”¨äº†ï¼š" + name);
}

function renderCalendar() {
    const grid = document.getElementById('calendarGrid');
    grid.innerHTML = '';
    const now = new Date();
    const y = now.getFullYear(), m = now.getMonth();
    document.getElementById('calTitle').innerText = `${y}å¹´${m+1}æœˆ`;
    const daysInMonth = new Date(y, m + 1, 0).getDate();
    for (let i = 1; i <= daysInMonth; i++) {
        const dStr = `${y}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
        const hasData = state.dailyLogs[dStr];
        const div = document.createElement('div');
        div.className = `cal-day ${hasData?'cal-has-data':''}`;
        div.innerText = i;
        div.onclick = () => showDetail(dStr);
        grid.appendChild(div);
    }
}

function showDetail(dStr) {
    const log = state.dailyLogs[dStr] || { done: {} };
    let html =`<strong>${dStr}</strong><br>`;
    for (let id in log.done) {
        const t = state.tasks.find(task => task.id == id);
        if (t) html += `${t.name}: ${log.done[id]}æ¬¡<br>`;
    }
    document.getElementById('detailContent').innerHTML = html;

    // é¡¯ç¤ºæ¯æ—¥ç¸½åˆ†åœ¨ç´€éŒ„é 
    renderDailyTotal(dStr, "dailyTotalRecord");
}
// --- 6. éŸ³æ•ˆã€è­¦å‘ŠæŒ‰éˆ•é‚è¼¯èˆ‡çµå°¾ ---
function playDing() {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.frequency.setValueAtTime(880, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
    osc.start(); osc.stop(ctx.currentTime + 0.5);
}

function triggerVibrate() { if ("vibrate" in navigator) navigator.vibrate([100, 50, 100]); }

function setupWarningButton() {
    const btn = document.getElementById('warningBtn');
    if (!btn) return;
    btn.addEventListener('pointerdown', e => { e.preventDefault(); handleWarningStart(); });
    const end = () => stopEffects();
    btn.addEventListener('pointerup', end);
    btn.addEventListener('pointercancel', end);
}

function handleWarningStart() {
    const btn = document.getElementById('warningBtn');
    if (btn) btn.classList.add('is-warning');
    warningTimer = setTimeout(() => { stopEffects(); showPage(6); }, 3000);
}

function stopEffects() {
    if (warningTimer) clearTimeout(warningTimer);
    const btn = document.getElementById('warningBtn');
    if (btn) btn.classList.remove('is-warning');
}

function formatRuby(text, zyStr) {
    if (!zyStr) return text;
    const chars = text.split(''), zys = zyStr.split('ï¼Œ');
    return chars.map((c, i) => `<ruby>${c}<rt>${zys[i]||''}</rt></ruby>`).join('');
}

function exportData() {
    try {
        // 1. æª¢æŸ¥è³‡æ–™æ˜¯å¦æ­£å¸¸
        if (!state) {
            alert("ç›®å‰æ²’æœ‰è³‡æ–™å¯ä»¥å‚™ä»½");
            return;
        }

        // 2. å°‡ state è½‰ç‚º JSON å­—ä¸²
        const dataStr = JSON.stringify(state, null, 2);
        
        // 3. å»ºç«‹ Blob ç‰©ä»¶ (æ‰‹æ©Ÿç«¯ä¸‹è¼‰çš„é—œéµ)
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        
        // 4. å»ºç«‹éš±å½¢çš„ä¸‹è¼‰é€£çµ
        const a = document.createElement('a');
        a.href = url;
        // æª”ååŠ ä¸Šæ—¥æœŸï¼Œæ–¹ä¾¿è¾¨è­˜
        const date = new Date().toISOString().slice(0, 10);
        a.download = `å¥½ç¿’æ…£å‚™ä»½_${date}.json`;
        
        // 5. è§¸ç™¼é»æ“Š
        document.body.appendChild(a);
        a.click();
        
        // 6. æ¸…ç†
        setTimeout(() => {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }, 100);

        alert("âœ… å‚™ä»½æŒ‡ä»¤å·²ç™¼é€ï¼\nè«‹æª¢æŸ¥ç€è¦½å™¨çš„ä¸‹è¼‰æ¸…å–®æˆ–æª”æ¡ˆç®¡ç†å“¡ã€‚");

    } catch (err) {
        alert("å‚™ä»½å¤±æ•—ï¼ŒéŒ¯èª¤è¨Šæ¯: " + err.message);
    }
}

function importData() {
    // 1. å»ºç«‹ä¸€å€‹éš±è—çš„æª”æ¡ˆé¸æ“‡å™¨
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json'; // é™åˆ¶åªèƒ½é¸ JSON æª”

    input.onchange = e => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = readerEvent => {
            try {
                // 2. è§£ææª”æ¡ˆå…§å®¹
                const content = JSON.parse(readerEvent.target.result);

                // 3. åŸºæœ¬æª¢æŸ¥ï¼šç¢ºèªé€™æ˜¯æˆ‘é€™æ”¯ App çš„è³‡æ–™ (æª¢æŸ¥æ˜¯å¦æœ‰å¿…è¦çš„æ¬„ä½)
                if (content && typeof content.points !== 'undefined') {
                    // 4. è¦†è“‹ç›®å‰çš„ state
                    state = content;
                    
                    // 5. å­˜å…¥æ‰‹æ©Ÿè¨˜æ†¶é«”
                    save();
                    
                    alert("âœ… è³‡æ–™é‚„åŸæˆåŠŸï¼");
                    
                    // 6. é—œéµï¼šé‡æ–°è¼‰å…¥é é¢ï¼Œè®“æ‰€æœ‰æ¸…å–®è·Ÿç©åˆ†é‡æ–°æ¸²æŸ“
                    location.reload();
                } else {
                    alert("âŒ å¤±æ•—ï¼šæ­¤æª”æ¡ˆä¼¼ä¹ä¸æ˜¯æ­£ç¢ºçš„å‚™ä»½æ ¼å¼ã€‚");
                }
            } catch (err) {
                alert("âŒ è§£æå¤±æ•—ï¼šæª”æ¡ˆå…§å®¹æ ¼å¼éŒ¯èª¤ã€‚\n" + err.message);
            }
        };

        // è®€å–æª”æ¡ˆå…§å®¹
        reader.readAsText(file);
    };

    // è§¸ç™¼é»æ“Šï¼Œé–‹å•Ÿæ‰‹æ©Ÿæˆ–é›»è…¦çš„æª”æ¡ˆé¸æ“‡è¦–çª—
    input.click();
}

// --- ä¿®å¾©ï¼šæ¸…é™¤è³‡æ–™åŠŸèƒ½ ---
function clearAllData() {
    // 1. å®‰å…¨ç¢ºèª
    if (confirm("âš ï¸ è­¦å‘Šï¼šé€™å°‡æ°¸ä¹…åˆªé™¤æ‰€æœ‰ä»»å‹™ã€ç©åˆ†èˆ‡é“å…·è¨˜éŒ„ï¼Œç¢ºå®šè¦åŸ·è¡Œå—ï¼Ÿ")) {
        
        // 2. æ¸…é™¤æ‰‹æ©Ÿè¨˜æ†¶é«”ä¸­ç‰¹å®šçš„è³‡æ–™å¤¾
        localStorage.removeItem('taskMasterV7');
        
        // 3. (é¸å¡«) æ¸…é™¤ç›®å‰ç€è¦½å™¨æ­£åœ¨åŸ·è¡Œçš„è®Šæ•¸ stateï¼Œæ¢å¾©åˆ°åˆå§‹å€¼
        state = { points: 0, tasks: [], items: [], inventory: {}, dailyLogs: {} };
        
        // 4. é—œéµï¼šé‡æ–°è¼‰å…¥ç¶²é ï¼Œè®“ç•«é¢æ­¸é›¶
        alert("âœ… æ‰€æœ‰è³‡æ–™å·²æ¸…ç©ºï¼");
        location.reload();
    }
}


// å•Ÿå‹•ï¼
init();
</script>

</body>
</html>


